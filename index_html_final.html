<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torres Vet - Sistema de Gesti√≥n Veterinaria</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #4A69BD 0%, #3742AB 100%);
            padding: 20px 0;
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .logo p {
            font-size: 14px;
            opacity: 0.8;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            border-left-color: #FFF;
            transform: translateX(5px);
        }

        .nav-item i {
            margin-right: 12px;
            font-size: 18px;
            width: 20px;
        }

        .logout-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .main-content {
            margin-left: 280px;
            padding: 30px;
            width: calc(100% - 280px);
            min-height: 100vh;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            color: #333;
            font-size: 28px;
            display: flex;
            align-items: center;
        }

        .section-header h2 i {
            margin-right: 10px;
            color: #4A69BD;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4A69BD, #3742AB);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 105, 189, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27AE60, #219A52);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #4A69BD;
            box-shadow: 0 0 0 3px rgba(74, 105, 189, 0.1);
        }

        .search-bar i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #4A69BD, #3742AB);
            color: white;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }

        .data-table tr:hover {
            background-color: #f8f9ff;
        }

        .data-table tr:nth-child(even) {
            background-color: #fafafa;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            color: #333;
            font-size: 24px;
        }

        .close {
            font-size: 28px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4A69BD;
            box-shadow: 0 0 0 3px rgba(74, 105, 189, 0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .dashboard-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .dashboard-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #4A69BD;
            margin-bottom: 5px;
        }

        .dashboard-card .description {
            color: #666;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .loading i {
            font-size: 48px;
            color: #4A69BD;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message, .success-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .api-config-warning {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #2d3436;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #e17055;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .api-config-warning h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-config-warning code {
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <h1>TORRES VET</h1>
            <p>SISTEMA SIMPLE</p>
        </div>
        
        <nav>
            <div class="nav-item active" data-section="dashboard">
                <i class="fas fa-chart-line"></i>
                Dashboard
            </div>
            <div class="nav-item" data-section="productos">
                <i class="fas fa-boxes"></i>
                Productos
            </div>
            <div class="nav-item" data-section="entradas">
                <i class="fas fa-arrow-down"></i>
                Entradas
            </div>
            <div class="nav-item" data-section="salidas">
                <i class="fas fa-arrow-up"></i>
                Salidas
            </div>
            <div class="nav-item" data-section="gastos">
                <i class="fas fa-receipt"></i>
                Gastos
            </div>
        </nav>

        <button class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            Cerrar Sesi√≥n
        </button>
    </div>

    <div class="main-content">
        <!-- Mensaje de configuraci√≥n de API -->
        <div class="api-config-warning">
            <h3><i class="fas fa-exclamation-triangle"></i> Configuraci√≥n Requerida</h3>
            <p><strong>¬°Importante!</strong> Para que el sistema funcione completamente, necesitas configurar tu API Key de Google Sheets.</p>
            <p>Reemplaza <code>TU_API_KEY_AQUI</code> en la l√≠nea 1001 del c√≥digo con tu API Key real de Google Cloud Console.</p>
            <p><i class="fas fa-info-circle"></i> Mientras tanto, el sistema funciona con datos de demostraci√≥n.</p>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <div class="section-header">
                <h2><i class="fas fa-chart-line"></i> Dashboard</h2>
            </div>
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3>Total Productos</h3>
                    <div class="number" id="total-productos">0</div>
                    <div class="description">Productos en inventario</div>
                </div>
                <div class="dashboard-card">
                    <h3>Entradas del Mes</h3>
                    <div class="number" id="total-entradas">0</div>
                    <div class="description">Productos ingresados</div>
                </div>
                <div class="dashboard-card">
                    <h3>Salidas del Mes</h3>
                    <div class="number" id="total-salidas">0</div>
                    <div class="description">Productos vendidos</div>
                </div>
                <div class="dashboard-card">
                    <h3>Gastos del Mes</h3>
                    <div class="number" id="total-gastos">$0</div>
                    <div class="description">Total en gastos</div>
                </div>
            </div>
        </div>

        <!-- Productos Section -->
        <div id="productos" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-boxes"></i> Productos</h2>
                <button class="btn btn-primary" onclick="openProductModal()">
                    <i class="fas fa-plus"></i>
                    Agregar Producto
                </button>
            </div>
            <div class="search-bar">
                <input type="text" id="search-productos" placeholder="Buscar productos...">
                <i class="fas fa-search"></i>
            </div>
            <div id="loading-productos" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Cargando productos...</p>
            </div>
            <table class="data-table" id="productos-table" style="display: none;">
                <thead>
                    <tr>
                        <th>C√≥digo</th>
                        <th>Descripci√≥n</th>
                        <th>P.U.</th>
                        <th>P.V.P.</th>
                        <th>Proveedor</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="productos-tbody">
                </tbody>
            </table>
        </div>

        <!-- Entradas Section -->
        <div id="entradas" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-arrow-down"></i> Entradas</h2>
                <button class="btn btn-success" onclick="openEntradaModal()">
                    <i class="fas fa-plus"></i>
                    Registrar Entrada
                </button>
            </div>
            <div class="search-bar">
                <input type="text" id="search-entradas" placeholder="Buscar entradas...">
                <i class="fas fa-search"></i>
            </div>
            <div id="loading-entradas" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Cargando entradas...</p>
            </div>
            <table class="data-table" id="entradas-table" style="display: none;">
                <thead>
                    <tr>
                        <th>ID Lote</th>
                        <th>Factura</th>
                        <th>Fecha</th>
                        <th>C√≥digo</th>
                        <th>Descripci√≥n</th>
                        <th>P.U.</th>
                        <th>P.V.P.</th>
                        <th>Proveedor</th>
                        <th>Venc.</th>
                        <th>Cant.</th>
                        <th>P.U Neto</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="entradas-tbody">
                </tbody>
            </table>
        </div>

        <!-- Salidas Section -->
        <div id="salidas" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-arrow-up"></i> Salidas</h2>
                <button class="btn btn-primary" onclick="openSalidaModal()">
                    <i class="fas fa-plus"></i>
                    Registrar Salida
                </button>
            </div>
            <div class="search-bar">
                <input type="text" id="search-salidas" placeholder="Buscar salidas...">
                <i class="fas fa-search"></i>
            </div>
            <div id="loading-salidas" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Cargando salidas...</p>
            </div>
            <table class="data-table" id="salidas-table" style="display: none;">
                <thead>
                    <tr>
                        <th>ID Venta</th>
                        <th>Fecha</th>
                        <th>ID Lote</th>
                        <th>C√≥digo</th>
                        <th>Descripci√≥n</th>
                        <th>P.V.P.</th>
                        <th>Venc.</th>
                        <th>Cant.</th>
                        <th>P.V.P Neto</th>
                        <th>Venta Total</th>
                    </tr>
                </thead>
                <tbody id="salidas-tbody">
                </tbody>
            </table>
        </div>

        <!-- Gastos Section -->
        <div id="gastos" class="content-section">
            <div class="section-header">
                <h2><i class="fas fa-receipt"></i> Gastos</h2>
                <button class="btn btn-danger" onclick="openGastoModal()">
                    <i class="fas fa-plus"></i>
                    Registrar Gasto
                </button>
            </div>
            <div class="search-bar">
                <input type="text" id="search-gastos" placeholder="Buscar gastos...">
                <i class="fas fa-search"></i>
            </div>
            <div id="loading-gastos" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Cargando gastos...</p>
            </div>
            <table class="data-table" id="gastos-table" style="display: none;">
                <thead>
                    <tr>
                        <th>ID Gasto</th>
                        <th>Fecha</th>
                        <th>Descripci√≥n</th>
                        <th>Categor√≠a</th>
                        <th>Monto Total</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="gastos-tbody">
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal para Productos -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Agregar Producto</h3>
                <span class="close" onclick="closeProductModal()">&times;</span>
            </div>
            <div id="productModalBody">
                <div class="form-row">
                    <div class="form-group">
                        <label>C√≥digo</label>
                        <input type="text" id="product-codigo" placeholder="P0000000">
                    </div>
                    <div class="form-group">
                        <label>Proveedor</label>
                        <select id="product-proveedor">
                            <option value="">Seleccionar...</option>
                            <option value="FARBIO">FARBIO</option>
                            <option value="FAVETEX">FAVETEX</option>
                            <option value="AGROMUNDI">AGROMUNDI</option>
                            <option value="MUNDO ANIMAL">MUNDO ANIMAL</option>
                            <option value="DOMENECH">DOMENECH</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <input type="text" id="product-descripcion" placeholder="Descripci√≥n del producto">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Precio Unitario (P.U.)</label>
                        <input type="number" id="product-pu" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Precio de Venta (P.V.P.)</label>
                        <input type="number" id="product-pvp" step="0.01" placeholder="0.00">
                    </div>
                </div>
                <div style="text-align: right; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="saveProduct()">
                        <i class="fas fa-save"></i>
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Entradas -->
    <div id="entradaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Registrar Entrada</h3>
                <span class="close" onclick="closeEntradaModal()">&times;</span>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ID Lote</label>
                    <input type="text" id="entrada-lote" placeholder="L01">
                </div>
                <div class="form-group">
                    <label>Factura</label>
                    <input type="text" id="entrada-factura" placeholder="003-001-000072531">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="entrada-fecha">
                </div>
                <div class="form-group">
                    <label>Producto</label>
                    <select id="entrada-producto">
                        <option value="">Seleccionar producto...</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Vencimiento</label>
                    <input type="date" id="entrada-vencimiento">
                </div>
                <div class="form-group">
                    <label>Cantidad</label>
                    <input type="number" id="entrada-cantidad" placeholder="1">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>P.U. Neto</label>
                    <input type="number" id="entrada-pu-neto" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div style="text-align: right; margin-top: 30px;">
                <button class="btn btn-success" onclick="saveEntrada()">
                    <i class="fas fa-save"></i>
                    Registrar Entrada
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Salidas -->
    <div id="salidaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Registrar Salida</h3>
                <span class="close" onclick="closeSalidaModal()">&times;</span>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ID Venta</label>
                    <input type="text" id="salida-venta" placeholder="V1">
                </div>
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="salida-fecha">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ID Lote</label>
                    <select id="salida-lote">
                        <option value="">Seleccionar lote...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cantidad</label>
                    <input type="number" id="salida-cantidad" placeholder="1">
                </div>
            </div>
            <div style="text-align: right; margin-top: 30px;">
                <button class="btn btn-primary" onclick="saveSalida()">
                    <i class="fas fa-save"></i>
                    Registrar Salida
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Gastos -->
    <div id="gastoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Registrar Gasto</h3>
                <span class="close" onclick="closeGastoModal()">&times;</span>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ID Gasto</label>
                    <input type="text" id="gasto-id" placeholder="G1">
                </div>
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="gasto-fecha">
                </div>
            </div>
            <div class="form-group">
                <label>Descripci√≥n</label>
                <input type="text" id="gasto-descripcion" placeholder="Descripci√≥n del gasto">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="gasto-categoria">
                        <option value="">Seleccionar categor√≠a...</option>
                        <option value="Servicios B√°sicos">Servicios B√°sicos</option>
                        <option value="Sueldo">Sueldo</option>
                        <option value="Arriendo">Arriendo</option>
                        <option value="Internet">Internet</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Monto Total</label>
                    <input type="number" id="gasto-monto" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div style="text-align: right; margin-top: 30px;">
                <button class="btn btn-danger" onclick="saveGasto()">
                    <i class="fas fa-save"></i>
                    Registrar Gasto
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // EDITAR Y ELIMINAR
        // ========================================
        
        function editProduct(codigo) {
            openProductModal(codigo);
        }

        function deleteProduct(codigo) {
            if (confirm('¬øEst√° seguro de que desea eliminar este producto?')) {
                const index = currentData.productos.findIndex(p => p.codigo === codigo);
                if (index >= 0) {
                    currentData.productos.splice(index, 1);
                    displayProductos();
                    populateProductSelects();
                    showSuccessMessage('‚úÖ Producto eliminado exitosamente');
                    updateDashboard();
                }
            }
        }

        function deleteGasto(idGasto) {
            if (confirm('¬øEst√° seguro de que desea eliminar este gasto?')) {
                const index = currentData.gastos.findIndex(g => g.idGasto === idGasto);
                if (index >= 0) {
                    currentData.gastos.splice(index, 1);
                    displayGastos();
                    updateDashboard();
                    showSuccessMessage('‚úÖ Gasto eliminado exitosamente');
                }
            }
        }

        // ========================================
        // EVENTOS GLOBALES
        // ========================================
        
        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // ========================================
        // FUNCIONES PARA GOOGLE SHEETS (AVANZADAS)
        // ========================================
        
        async function appendToGoogleSheet(range, values) {
            if (API_KEY === 'TU_API_KEY_AQUI') return;
            
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}:append?valueInputOption=RAW&key=${API_KEY}`;
            
            const body = {
                values: [values]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Google Sheets API error: ${errorData.error?.message || response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('Error updating Google Sheets:', error);
                showErrorMessage('‚ùå Error al guardar en Google Sheets: ' + error.message);
                throw error;
            }
        }

        async function saveProductToSheet(producto) {
            try {
                const values = [
                    producto.codigo,
                    producto.descripcion,
                    `${producto.pu.toFixed(2)}`,
                    `${producto.pvp.toFixed(2)}`,
                    producto.proveedor
                ];
                
                await appendToGoogleSheet(SHEETS_CONFIG.productos, values);
                showSuccessMessage('‚úÖ Producto guardado en Google Sheets');
                
            } catch (error) {
                console.error('Error saving product to sheets:', error);
            }
        }

        async function saveEntradaToSheet(entrada) {
            try {
                const values = [
                    entrada.idLote,
                    entrada.factura,
                    entrada.fecha,
                    entrada.codigo,
                    entrada.descripcion,
                    `${entrada.pu.toFixed(2)}`,
                    `${entrada.pvp.toFixed(2)}`,
                    entrada.proveedor,
                    entrada.venc,
                    entrada.cant.toString(),
                    `${entrada.puNeto.toFixed(2)}`,
                    `${entrada.total.toFixed(2)}`
                ];
                
                await appendToGoogleSheet(SHEETS_CONFIG.entradas, values);
                showSuccessMessage('‚úÖ Entrada guardada en Google Sheets');
                
            } catch (error) {
                console.error('Error saving entrada to sheets:', error);
            }
        }

        async function saveSalidaToSheet(salida) {
            try {
                const values = [
                    salida.idVenta,
                    salida.fecha,
                    salida.idLote,
                    salida.codigo,
                    salida.descripcion,
                    `${salida.pvp.toFixed(2)}`,
                    salida.venc,
                    salida.cant.toString(),
                    `${salida.pvpNeto.toFixed(2)}`,
                    `${salida.ventaTotal.toFixed(2)}`
                ];
                
                await appendToGoogleSheet(SHEETS_CONFIG.salidas, values);
                showSuccessMessage('‚úÖ Salida guardada en Google Sheets');
                
            } catch (error) {
                console.error('Error saving salida to sheets:', error);
            }
        }

        async function saveGastoToSheet(gasto) {
            try {
                const values = [
                    gasto.idGasto,
                    gasto.fecha,
                    gasto.descripcion,
                    gasto.categoria,
                    `${gasto.monto.toFixed(2)}`
                ];
                
                await appendToGoogleSheet(SHEETS_CONFIG.gastos, values);
                showSuccessMessage('‚úÖ Gasto guardado en Google Sheets');
                
            } catch (error) {
                console.error('Error saving gasto to sheets:', error);
            }
        }

        // ========================================
        // VALIDADOR DE CONEXI√ìN
        // ========================================
        
        async function testGoogleSheetsConnection() {
            if (API_KEY === 'TU_API_KEY_AQUI') {
                return false;
            }
            
            try {
                const testRange = 'PRODUCTOS!A1:A1';
                await fetchFromGoogleSheets(testRange);
                console.log('‚úÖ Conexi√≥n con Google Sheets exitosa');
                showSuccessMessage('üöÄ Conectado exitosamente con Google Sheets');
                return true;
            } catch (error) {
                console.error('‚ùå Error de conexi√≥n con Google Sheets:', error);
                showErrorMessage('‚ùå Error de conexi√≥n con Google Sheets: ' + error.message);
                return false;
            }
        }

        // Modificar las funciones de guardado para incluir sincronizaci√≥n con Google Sheets
        const originalSaveProduct = saveProduct;
        saveProduct = async function() {
            const codigo = document.getElementById('product-codigo').value;
            const descripcion = document.getElementById('product-descripcion').value;
            const pu = parseFloat(document.getElementById('product-pu').value);
            const pvp = parseFloat(document.getElementById('product-pvp').value);
            const proveedor = document.getElementById('product-proveedor').value;

            if (!codigo || !descripcion || !pu || !pvp || !proveedor) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const existingIndex = currentData.productos.findIndex(p => p.codigo === codigo);
            const productData = { codigo, descripcion, pu, pvp, proveedor };

            if (existingIndex >= 0) {
                currentData.productos[existingIndex] = productData;
                showSuccessMessage('‚úÖ Producto actualizado exitosamente');
            } else {
                currentData.productos.push(productData);
                showSuccessMessage('‚úÖ Producto agregado exitosamente');
                
                // Guardar en Google Sheets solo si es nuevo producto
                if (API_KEY !== 'TU_API_KEY_AQUI') {
                    await saveProductToSheet(productData);
                }
            }

            displayProductos();
            populateProductSelects();
            closeProductModal();
            updateDashboard();
        };

        const originalSaveEntrada = saveEntrada;
        saveEntrada = async function() {
            const idLote = document.getElementById('entrada-lote').value;
            const factura = document.getElementById('entrada-factura').value;
            const fecha = document.getElementById('entrada-fecha').value;
            const codigoProducto = document.getElementById('entrada-producto').value;
            const vencimiento = document.getElementById('entrada-vencimiento').value;
            const cantidad = parseInt(document.getElementById('entrada-cantidad').value);
            const puNeto = parseFloat(document.getElementById('entrada-pu-neto').value);

            if (!idLote || !factura || !fecha || !codigoProducto || !vencimiento || !cantidad || !puNeto) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const producto = currentData.productos.find(p => p.codigo === codigoProducto);
            const total = puNeto * cantidad;

            const entradaData = {
                idLote,
                factura,
                fecha: formatDate(fecha),
                codigo: codigoProducto,
                descripcion: producto.descripcion,
                pu: producto.pu,
                pvp: producto.pvp,
                proveedor: producto.proveedor,
                venc: formatDate(vencimiento),
                cant: cantidad,
                puNeto,
                total
            };

            currentData.entradas.push(entradaData);
            displayEntradas();
            closeEntradaModal();
            showSuccessMessage('‚úÖ Entrada registrada exitosamente');
            updateDashboard();
            
            // Guardar en Google Sheets
            if (API_KEY !== 'TU_API_KEY_AQUI') {
                await saveEntradaToSheet(entradaData);
            }
            
            // Limpiar formulario
            document.getElementById('entrada-lote').value = '';
            document.getElementById('entrada-factura').value = '';
            document.getElementById('entrada-producto').value = '';
            document.getElementById('entrada-cantidad').value = '';
            document.getElementById('entrada-pu-neto').value = '';
        };

        const originalSaveSalida = saveSalida;
        saveSalida = async function() {
            const idVenta = document.getElementById('salida-venta').value;
            const fecha = document.getElementById('salida-fecha').value;
            const idLote = document.getElementById('salida-lote').value;
            const cantidad = parseInt(document.getElementById('salida-cantidad').value);

            if (!idVenta || !fecha || !idLote || !cantidad) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const entrada = currentData.entradas.find(e => e.idLote === idLote);
            const ventaTotal = entrada.pvp * cantidad;

            const salidaData = {
                idVenta,
                fecha: formatDate(fecha),
                idLote,
                codigo: entrada.codigo,
                descripcion: entrada.descripcion,
                pvp: entrada.pvp,
                venc: entrada.venc,
                cant: cantidad,
                pvpNeto: entrada.pvp,
                ventaTotal
            };

            currentData.salidas.push(salidaData);
            displaySalidas();
            closeSalidaModal();
            showSuccessMessage('‚úÖ Salida registrada exitosamente');
            updateDashboard();
            
            // Guardar en Google Sheets
            if (API_KEY !== 'TU_API_KEY_AQUI') {
                await saveSalidaToSheet(salidaData);
            }
            
            // Limpiar formulario
            document.getElementById('salida-venta').value = '';
            document.getElementById('salida-lote').value = '';
            document.getElementById('salida-cantidad').value = '';
        };

        const originalSaveGasto = saveGasto;
        saveGasto = async function() {
            const idGasto = document.getElementById('gasto-id').value;
            const fecha = document.getElementById('gasto-fecha').value;
            const descripcion = document.getElementById('gasto-descripcion').value;
            const categoria = document.getElementById('gasto-categoria').value;
            const monto = parseFloat(document.getElementById('gasto-monto').value);

            if (!idGasto || !fecha || !descripcion || !categoria || !monto) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const gastoData = {
                idGasto,
                fecha: formatDate(fecha),
                descripcion,
                categoria,
                monto
            };

            currentData.gastos.push(gastoData);
            displayGastos();
            closeGastoModal();
            showSuccessMessage('‚úÖ Gasto registrado exitosamente');
            updateDashboard();
            
            // Guardar en Google Sheets
            if (API_KEY !== 'TU_API_KEY_AQUI') {
                await saveGastoToSheet(gastoData);
            }
            
            // Limpiar formulario
            document.getElementById('gasto-descripcion').value = '';
            document.getElementById('gasto-categoria').value = '';
            document.getElementById('gasto-monto').value = '';
        };

        // Verificar conexi√≥n al cargar la p√°gina
        setTimeout(async () => {
            await testGoogleSheetsConnection();
        }, 1000);
    </script>
</body>
</html>
        // CONFIGURACI√ìN
        // ========================================
        
        // ‚ö†Ô∏è IMPORTANTE: Reemplaza con tu API Key real de Google Cloud Console
        const SPREADSHEET_ID = '1Frbr8J8Wi0H0YyOVEu_WGTP7BkPEuq8xlS6BqZWtR-s';
        const API_KEY = 'TU_API_KEY_AQUI'; // üëà CAMBIAR ESTE VALOR
        
        // URLs para cada hoja
        const SHEETS_CONFIG = {
            productos: 'PRODUCTOS!A:E',
            entradas: 'ENTRADAS!A:L',
            salidas: 'SALIDAS!A:J',
            gastos: 'GASTOS!A:E'
        };

        let currentData = {
            productos: [],
            entradas: [],
            salidas: [],
            gastos: []
        };

        // ========================================
        // INICIALIZACI√ìN
        // ========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            
            // Event listeners para navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Event listeners para b√∫squedas
            document.getElementById('search-productos').addEventListener('input', filterProductos);
            document.getElementById('search-entradas').addEventListener('input', filterEntradas);
            document.getElementById('search-salidas').addEventListener('input', filterSalidas);
            document.getElementById('search-gastos').addEventListener('input', filterGastos);

            // Configurar fecha actual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('entrada-fecha').value = today;
            document.getElementById('salida-fecha').value = today;
            document.getElementById('gasto-fecha').value = today;
        });

        function initApp() {
            // Verificar si se configur√≥ API Key
            if (API_KEY === 'TU_API_KEY_AQUI') {
                showErrorMessage('‚ö†Ô∏è API Key no configurada. Usando datos de demostraci√≥n.');
                loadDemoData();
            } else {
                loadAllData();
            }
        }

        // ========================================
        // NAVEGACI√ìN
        // ========================================
        
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            
            if (sectionName !== 'dashboard') {
                loadSectionData(sectionName);
            }
        }

        // ========================================
        // CARGA DE DATOS DEMO (PARA PRUEBAS)
        // ========================================
        
        function loadDemoData() {
            currentData.productos = [
                { codigo: 'P0000006', descripcion: 'LEGXUS X 30ML', pu: 1.10, pvp: 1.25, proveedor: 'FARBIO' },
                { codigo: 'P0000005', descripcion: 'FAVECAN X 2ML', pu: 1.70, pvp: 3.00, proveedor: 'FAVETEX' },
                { codigo: 'P0000004', descripcion: 'CURA HERIDAS - 2 X 100ML', pu: 2.60, pvp: 3.50, proveedor: 'FAVETEX' },
                { codigo: 'P0000003', descripcion: 'FIPRONIL SPRAY X 100ML', pu: 6.50, pvp: 9.00, proveedor: 'FAVETEX' },
                { codigo: 'P0000002', descripcion: 'RATEX X 30G', pu: 1.75, pvp: 1.75, proveedor: 'FARBIO' },
                { codigo: 'P0000001', descripcion: 'CLASS ZERO X 20ML', pu: 7.25, pvp: 9.25, proveedor: 'AGROMUNDI' }
            ];

            currentData.entradas = [
                { 
                    idLote: 'L12', factura: '003-001-000072531', fecha: '1/9/2025', 
                    codigo: 'P0000003', descripcion: 'FIPRONIL SPRAY X 100ML', 
                    pu: 6.50, pvp: 9.00, proveedor: 'FAVETEX', venc: '1/9/2027', 
                    cant: 6, puNeto: 3.90, total: 23.40 
                },
                { 
                    idLote: 'L11', factura: '003-001-000072531', fecha: '31/8/2025', 
                    codigo: 'P0000006', descripcion: 'LEGXUS X 30ML', 
                    pu: 1.10, pvp: 1.25, proveedor: 'FARBIO', venc: '31/8/2027', 
                    cant: 55, puNeto: 0.88, total: 48.40 
                }
            ];

            currentData.salidas = [
                { 
                    idVenta: 'V1', fecha: '27/8/2025', idLote: 'L2', 
                    codigo: 'P0000001', descripcion: 'CLASS ZERO X 20ML', 
                    pvp: 9.25, venc: '1/5/2027', cant: 2, 
                    pvpNeto: 9.00, ventaTotal: 18.00 
                }
            ];

            currentData.gastos = [
                { idGasto: 'G8', fecha: '2/9/2025', descripcion: 'energ√≠a el√©ctrica', categoria: 'Servicios B√°sicos', monto: 110.00 },
                { idGasto: 'G7', fecha: '1/9/2025', descripcion: 'JEIMMY', categoria: 'Sueldo', monto: 25.00 },
                { idGasto: 'G6', fecha: '1/9/2025', descripcion: 'local', categoria: 'Arriendo', monto: 170.00 },
                { idGasto: 'G5', fecha: '31/8/2025', descripcion: 'HAZNET', categoria: 'Internet', monto: 20.00 }
            ];

            // Mostrar datos en todas las secciones
            displayProductos();
            displayEntradas();
            displaySalidas();
            displayGastos();
            populateProductSelects();
            updateDashboard();
            
            setTimeout(() => {
                hideLoading('productos');
                hideLoading('entradas');
                hideLoading('salidas');
                hideLoading('gastos');
            }, 500);
        }

        // ========================================
        // CARGA DE DATOS REALES (GOOGLE SHEETS)
        // ========================================
        
        async function loadAllData() {
            try {
                await Promise.all([
                    loadProductos(),
                    loadEntradas(),
                    loadSalidas(),
                    loadGastos()
                ]);
                updateDashboard();
                showSuccessMessage('‚úÖ Datos cargados desde Google Sheets');
            } catch (error) {
                console.error('Error cargando datos:', error);
                showErrorMessage('‚ùå Error al cargar datos. Usando modo demo.');
                loadDemoData();
            }
        }

        async function loadSectionData(section) {
            if (API_KEY === 'TU_API_KEY_AQUI') return;
            
            switch(section) {
                case 'productos': await loadProductos(); break;
                case 'entradas': await loadEntradas(); break;
                case 'salidas': await loadSalidas(); break;
                case 'gastos': await loadGastos(); break;
            }
        }

        async function fetchFromGoogleSheets(range) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`;
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Error ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            return data.values || [];
        }

        async function loadProductos() {
            showLoading('productos');
            try {
                const data = await fetchFromGoogleSheets(SHEETS_CONFIG.productos);
                const productos = data.slice(1).map(row => ({
                    codigo: row[0] || '',
                    descripcion: row[1] || '',
                    pu: parseFloat(row[2]?.replace('
                        , '') || 0),
                    pvp: parseFloat(row[3]?.replace('
                        , '') || 0),
                    proveedor: row[4] || ''
                })).filter(producto => producto.codigo);
                
                currentData.productos = productos;
                displayProductos();
                populateProductSelects();
                hideLoading('productos');
            } catch (error) {
                hideLoading('productos');
                throw error;
            }
        }

        async function loadEntradas() {
            showLoading('entradas');
            try {
                const data = await fetchFromGoogleSheets(SHEETS_CONFIG.entradas);
                const entradas = data.slice(1).map(row => ({
                    idLote: row[0] || '',
                    factura: row[1] || '',
                    fecha: row[2] || '',
                    codigo: row[3] || '',
                    descripcion: row[4] || '',
                    pu: parseFloat(row[5]?.replace('
                        , '') || 0),
                    pvp: parseFloat(row[6]?.replace('
                        , '') || 0),
                    proveedor: row[7] || '',
                    venc: row[8] || '',
                    cant: parseInt(row[9] || 0),
                    puNeto: parseFloat(row[10]?.replace('
                        , '') || 0),
                    total: parseFloat(row[11]?.replace('
                        , '') || 0)
                })).filter(entrada => entrada.idLote);
                
                currentData.entradas = entradas;
                displayEntradas();
                hideLoading('entradas');
            } catch (error) {
                hideLoading('entradas');
                throw error;
            }
        }

        async function loadSalidas() {
            showLoading('salidas');
            try {
                const data = await fetchFromGoogleSheets(SHEETS_CONFIG.salidas);
                const salidas = data.slice(1).map(row => ({
                    idVenta: row[0] || '',
                    fecha: row[1] || '',
                    idLote: row[2] || '',
                    codigo: row[3] || '',
                    descripcion: row[4] || '',
                    pvp: parseFloat(row[5]?.replace('
                        , '') || 0),
                    venc: row[6] || '',
                    cant: parseInt(row[7] || 0),
                    pvpNeto: parseFloat(row[8]?.replace('
                        , '') || 0),
                    ventaTotal: parseFloat(row[9]?.replace('
                        , '') || 0)
                })).filter(salida => salida.idVenta);
                
                currentData.salidas = salidas;
                displaySalidas();
                hideLoading('salidas');
            } catch (error) {
                hideLoading('salidas');
                throw error;
            }
        }

        async function loadGastos() {
            showLoading('gastos');
            try {
                const data = await fetchFromGoogleSheets(SHEETS_CONFIG.gastos);
                const gastos = data.slice(1).map(row => ({
                    idGasto: row[0] || '',
                    fecha: row[1] || '',
                    descripcion: row[2] || '',
                    categoria: row[3] || '',
                    monto: parseFloat(row[4]?.replace('
                        , '') || 0)
                })).filter(gasto => gasto.idGasto);
                
                currentData.gastos = gastos;
                displayGastos();
                hideLoading('gastos');
            } catch (error) {
                hideLoading('gastos');
                throw error;
            }
        }

        // ========================================
        // MOSTRAR DATOS EN TABLAS
        // ========================================
        
        function displayProductos() {
            const tbody = document.getElementById('productos-tbody');
            tbody.innerHTML = '';
            
            currentData.productos.forEach(producto => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${producto.codigo}</td>
                    <td>${producto.descripcion}</td>
                    <td>${producto.pu.toFixed(2)}</td>
                    <td>${producto.pvp.toFixed(2)}</td>
                    <td>${producto.proveedor}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editProduct('${producto.codigo}')" style="margin-right: 5px; padding: 8px 12px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteProduct('${producto.codigo}')" style="padding: 8px 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
            });
            
            document.getElementById('productos-table').style.display = 'table';
        }

        function displayEntradas() {
            const tbody = document.getElementById('entradas-tbody');
            tbody.innerHTML = '';
            
            currentData.entradas.forEach(entrada => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${entrada.idLote}</td>
                    <td>${entrada.factura}</td>
                    <td>${entrada.fecha}</td>
                    <td>${entrada.codigo}</td>
                    <td>${entrada.descripcion}</td>
                    <td>${entrada.pu.toFixed(2)}</td>
                    <td>${entrada.pvp.toFixed(2)}</td>
                    <td>${entrada.proveedor}</td>
                    <td>${entrada.venc}</td>
                    <td>${entrada.cant}</td>
                    <td>${entrada.puNeto.toFixed(2)}</td>
                    <td>${entrada.total.toFixed(2)}</td>
                `;
            });
            
            document.getElementById('entradas-table').style.display = 'table';
        }

        function displaySalidas() {
            const tbody = document.getElementById('salidas-tbody');
            tbody.innerHTML = '';
            
            currentData.salidas.forEach(salida => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${salida.idVenta}</td>
                    <td>${salida.fecha}</td>
                    <td>${salida.idLote}</td>
                    <td>${salida.codigo}</td>
                    <td>${salida.descripcion}</td>
                    <td>${salida.pvp.toFixed(2)}</td>
                    <td>${salida.venc}</td>
                    <td>${salida.cant}</td>
                    <td>${salida.pvpNeto.toFixed(2)}</td>
                    <td>${salida.ventaTotal.toFixed(2)}</td>
                `;
            });
            
            document.getElementById('salidas-table').style.display = 'table';
        }

        function displayGastos() {
            const tbody = document.getElementById('gastos-tbody');
            tbody.innerHTML = '';
            
            currentData.gastos.forEach(gasto => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${gasto.idGasto}</td>
                    <td>${gasto.fecha}</td>
                    <td>${gasto.descripcion}</td>
                    <td>${gasto.categoria}</td>
                    <td>${gasto.monto.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteGasto('${gasto.idGasto}')" style="padding: 8px 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
            });
            
            document.getElementById('gastos-table').style.display = 'table';
        }

        // ========================================
        // FUNCIONES DE FILTRADO
        // ========================================
        
        function filterProductos() {
            const searchTerm = document.getElementById('search-productos').value.toLowerCase();
            const rows = document.querySelectorAll('#productos-tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterEntradas() {
            const searchTerm = document.getElementById('search-entradas').value.toLowerCase();
            const rows = document.querySelectorAll('#entradas-tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterSalidas() {
            const searchTerm = document.getElementById('search-salidas').value.toLowerCase();
            const rows = document.querySelectorAll('#salidas-tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function filterGastos() {
            const searchTerm = document.getElementById('search-gastos').value.toLowerCase();
            const rows = document.querySelectorAll('#gastos-tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // ========================================
        // DASHBOARD
        // ========================================
        
        function updateDashboard() {
            document.getElementById('total-productos').textContent = currentData.productos.length;
            document.getElementById('total-entradas').textContent = currentData.entradas.length;
            document.getElementById('total-salidas').textContent = currentData.salidas.length;
            
            const totalGastos = currentData.gastos.reduce((sum, gasto) => sum + gasto.monto, 0);
            document.getElementById('total-gastos').textContent = `${totalGastos.toFixed(2)}`;
        }

        // ========================================
        // MODALES
        // ========================================
        
        function openProductModal(codigo = null) {
            const modal = document.getElementById('productModal');
            const title = document.getElementById('productModalTitle');
            
            if (codigo) {
                const producto = currentData.productos.find(p => p.codigo === codigo);
                title.textContent = 'Editar Producto';
                document.getElementById('product-codigo').value = producto.codigo;
                document.getElementById('product-descripcion').value = producto.descripcion;
                document.getElementById('product-pu').value = producto.pu;
                document.getElementById('product-pvp').value = producto.pvp;
                document.getElementById('product-proveedor').value = producto.proveedor;
                document.getElementById('product-codigo').readOnly = true;
            } else {
                title.textContent = 'Agregar Producto';
                document.getElementById('product-codigo').value = generateNextProductCode();
                document.getElementById('product-descripcion').value = '';
                document.getElementById('product-pu').value = '';
                document.getElementById('product-pvp').value = '';
                document.getElementById('product-proveedor').value = '';
                document.getElementById('product-codigo').readOnly = false;
            }
            
            modal.style.display = 'block';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function openEntradaModal() {
            populateProductSelects();
            document.getElementById('entradaModal').style.display = 'block';
        }

        function closeEntradaModal() {
            document.getElementById('entradaModal').style.display = 'none';
        }

        function openSalidaModal() {
            populateLoteSelects();
            document.getElementById('salidaModal').style.display = 'block';
        }

        function closeSalidaModal() {
            document.getElementById('salidaModal').style.display = 'none';
        }

        function openGastoModal() {
            document.getElementById('gasto-id').value = generateNextGastoId();
            document.getElementById('gastoModal').style.display = 'block';
        }

        function closeGastoModal() {
            document.getElementById('gastoModal').style.display = 'none';
        }

        // ========================================
        // GUARDAR DATOS
        // ========================================
        
        function saveProduct() {
            const codigo = document.getElementById('product-codigo').value;
            const descripcion = document.getElementById('product-descripcion').value;
            const pu = parseFloat(document.getElementById('product-pu').value);
            const pvp = parseFloat(document.getElementById('product-pvp').value);
            const proveedor = document.getElementById('product-proveedor').value;

            if (!codigo || !descripcion || !pu || !pvp || !proveedor) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const existingIndex = currentData.productos.findIndex(p => p.codigo === codigo);
            const productData = { codigo, descripcion, pu, pvp, proveedor };

            if (existingIndex >= 0) {
                currentData.productos[existingIndex] = productData;
                showSuccessMessage('‚úÖ Producto actualizado exitosamente');
            } else {
                currentData.productos.push(productData);
                showSuccessMessage('‚úÖ Producto agregado exitosamente');
            }

            displayProductos();
            populateProductSelects();
            closeProductModal();
            
            // TODO: Implementar guardado en Google Sheets cuando API_KEY est√© configurada
            if (API_KEY !== 'TU_API_KEY_AQUI') {
                // saveProductToSheet(productData);
            }
        }

        function saveEntrada() {
            const idLote = document.getElementById('entrada-lote').value;
            const factura = document.getElementById('entrada-factura').value;
            const fecha = document.getElementById('entrada-fecha').value;
            const codigoProducto = document.getElementById('entrada-producto').value;
            const vencimiento = document.getElementById('entrada-vencimiento').value;
            const cantidad = parseInt(document.getElementById('entrada-cantidad').value);
            const puNeto = parseFloat(document.getElementById('entrada-pu-neto').value);

            if (!idLote || !factura || !fecha || !codigoProducto || !vencimiento || !cantidad || !puNeto) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const producto = currentData.productos.find(p => p.codigo === codigoProducto);
            const total = puNeto * cantidad;

            const entradaData = {
                idLote,
                factura,
                fecha: formatDate(fecha),
                codigo: codigoProducto,
                descripcion: producto.descripcion,
                pu: producto.pu,
                pvp: producto.pvp,
                proveedor: producto.proveedor,
                venc: formatDate(vencimiento),
                cant: cantidad,
                puNeto,
                total
            };

            currentData.entradas.push(entradaData);
            displayEntradas();
            closeEntradaModal();
            showSuccessMessage('‚úÖ Entrada registrada exitosamente');
            updateDashboard();
            
            // Limpiar formulario
            document.getElementById('entrada-lote').value = '';
            document.getElementById('entrada-factura').value = '';
            document.getElementById('entrada-producto').value = '';
            document.getElementById('entrada-cantidad').value = '';
            document.getElementById('entrada-pu-neto').value = '';
        }

        function saveSalida() {
            const idVenta = document.getElementById('salida-venta').value;
            const fecha = document.getElementById('salida-fecha').value;
            const idLote = document.getElementById('salida-lote').value;
            const cantidad = parseInt(document.getElementById('salida-cantidad').value);

            if (!idVenta || !fecha || !idLote || !cantidad) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const entrada = currentData.entradas.find(e => e.idLote === idLote);
            const ventaTotal = entrada.pvp * cantidad;

            const salidaData = {
                idVenta,
                fecha: formatDate(fecha),
                idLote,
                codigo: entrada.codigo,
                descripcion: entrada.descripcion,
                pvp: entrada.pvp,
                venc: entrada.venc,
                cant: cantidad,
                pvpNeto: entrada.pvp,
                ventaTotal
            };

            currentData.salidas.push(salidaData);
            displaySalidas();
            closeSalidaModal();
            showSuccessMessage('‚úÖ Salida registrada exitosamente');
            updateDashboard();
            
            // Limpiar formulario
            document.getElementById('salida-venta').value = '';
            document.getElementById('salida-lote').value = '';
            document.getElementById('salida-cantidad').value = '';
        }

        function saveGasto() {
            const idGasto = document.getElementById('gasto-id').value;
            const fecha = document.getElementById('gasto-fecha').value;
            const descripcion = document.getElementById('gasto-descripcion').value;
            const categoria = document.getElementById('gasto-categoria').value;
            const monto = parseFloat(document.getElementById('gasto-monto').value);

            if (!idGasto || !fecha || !descripcion || !categoria || !monto) {
                alert('Por favor, complete todos los campos');
                return;
            }

            const gastoData = {
                idGasto,
                fecha: formatDate(fecha),
                descripcion,
                categoria,
                monto
            };

            currentData.gastos.push(gastoData);
            displayGastos();
            closeGastoModal();
            showSuccessMessage('‚úÖ Gasto registrado exitosamente');
            updateDashboard();
            
            // Limpiar formulario
            document.getElementById('gasto-descripcion').value = '';
            document.getElementById('gasto-categoria').value = '';
            document.getElementById('gasto-monto').value = '';
        }

        // ========================================
        // FUNCIONES AUXILIARES
        // ========================================
        
        function generateNextProductCode() {
            if (currentData.productos.length === 0) return 'P0000001';
            
            const lastProduct = currentData.productos[currentData.productos.length - 1];
            const lastNumber = parseInt(lastProduct.codigo.substring(1));
            const nextNumber = lastNumber + 1;
            return 'P' + nextNumber.toString().padStart(7, '0');
        }

        function generateNextGastoId() {
            if (currentData.gastos.length === 0) return 'G1';
            
            const maxId = Math.max(...currentData.gastos.map(g => parseInt(g.idGasto.substring(1))));
            return 'G' + (maxId + 1);
        }

        function populateProductSelects() {
            const select = document.getElementById('entrada-producto');
            select.innerHTML = '<option value="">Seleccionar producto...</option>';
            
            currentData.productos.forEach(producto => {
                const option = document.createElement('option');
                option.value = producto.codigo;
                option.textContent = `${producto.codigo} - ${producto.descripcion}`;
                select.appendChild(option);
            });
        }

        function populateLoteSelects() {
            const select = document.getElementById('salida-lote');
            select.innerHTML = '<option value="">Seleccionar lote...</option>';
            
            currentData.entradas.forEach(entrada => {
                const option = document.createElement('option');
                option.value = entrada.idLote;
                option.textContent = `${entrada.idLote} - ${entrada.descripcion}`;
                select.appendChild(option);
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }

        function showLoading(section) {
            document.getElementById(`loading-${section}`).style.display = 'block';
            document.getElementById(`${section}-table`).style.display = 'none';
        }

        function hideLoading(section) {
            document.getElementById(`loading-${section}`).style.display = 'none';
        }

        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            
            const mainContent = document.querySelector('.main-content');
            mainContent.insertBefore(messageDiv, mainContent.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        function showErrorMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'error-message';
            messageDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            
            const mainContent = document.querySelector('.main-content');
            mainContent.insertBefore(messageDiv, mainContent.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // ========================================
        
                        